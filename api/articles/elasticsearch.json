{"title":"ElasticSearch","uid":"dd22f9d802401409d7599accbe2b4aa4","slug":"elasticsearch","date":"2023-08-18T18:59:34.000Z","updated":"2023-08-23T13:01:57.052Z","comments":true,"path":"api/articles/elasticsearch.json","keywords":null,"cover":[],"content":"<h1 id=\"ElasticSearch\"><a href=\"#ElasticSearch\" class=\"headerlink\" title=\"ElasticSearch\"></a>ElasticSearch</h1><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>版本：7.6</p>\n<p>全文检索引擎</p>\n<p>SQL查询时， 大数据情况下速度很慢，在加索引都无法满足的情况下，可以选择ES作为解决方案</p>\n<h3 id=\"Lucene\"><a href=\"#Lucene\" class=\"headerlink\" title=\"Lucene\"></a>Lucene</h3><p>Lucene是一套信息检索工具jar包，不包含搜索引擎系统</p>\n<p>包含：</p>\n<ul>\n<li>索引结构</li>\n<li>排序功能</li>\n<li>搜索规则</li>\n</ul>\n<p>Lucene和ES的关系： ES是基于Lucene做了一些封装和增强</p>\n<h3 id=\"ElasticSearch概述\"><a href=\"#ElasticSearch概述\" class=\"headerlink\" title=\"ElasticSearch概述\"></a>ElasticSearch概述</h3><p>ES是一个开源<strong>高扩展</strong>的分布式全文搜索引擎，可以近乎<strong>实时</strong>的</p>\n<p>存储、检索数据； 本身<strong>扩展性</strong>很好，可以扩展到上百台服务器。ES使用java开发的Lucene作为核心实现所有的索引和搜索的功能，通过简单的 <strong>RESTful API</strong>来简化复杂的Lucene，更容易上手。</p>\n<h3 id=\"Solr概述\"><a href=\"#Solr概述\" class=\"headerlink\" title=\"Solr概述\"></a>Solr概述</h3><p>Solr采用java开发，基于Lucene的全文搜索服务器。Solr可以独立运行jetty, tomcat等web容器中。提供了WebService API</p>\n<h3 id=\"ES和Solr的差别\"><a href=\"#ES和Solr的差别\" class=\"headerlink\" title=\"ES和Solr的差别\"></a>ES和Solr的差别</h3><p>从性能上：</p>\n<ul>\n<li>对单纯已有数据进行搜索时，solr更快</li>\n<li>当实时建立索引时，solr会产生IO阻塞，查询性能较差</li>\n<li>随着数据量的增加，solr的搜索效率会变低，而es变化不大</li>\n</ul>\n<p>从功能上：</p>\n<ul>\n<li>es基本是开箱即用</li>\n<li>solr利用zookeeper进行分布式管理，而es自带分布式协调管理功能</li>\n<li>solr支持多格式数据如 JSON&#x2F;XML&#x2F;CSV，而es只支持JSON</li>\n</ul>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>Q: 如何选择ES和Solr</p>\n<p>A: 无论是从性能还是从功能上，ES都是更好的选择</p></blockquote>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><h3 id=\"ElasticSearch-1\"><a href=\"#ElasticSearch-1\" class=\"headerlink\" title=\"ElasticSearch\"></a>ElasticSearch</h3><p><strong>7.6版本 JDK最低要求1.8</strong></p>\n<p>官网下载 [ElasticSearch]<a href=\"https://www.elastic.co/cn/downloads/elasticsearch\">Download Elasticsearch | Elastic</a></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>windows下安装</p></blockquote>\n<ul>\n<li><p>下载压缩包解压到目标文件夹</p>\n</li>\n<li><p>目录结构</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">bin 可执行文件等\nconfig 配置文件\n\t- log4j2.properties 日志配置\n\t- jvm.options jvm参数，需要配置运行内存，默认1GB运存\n\t- elasticsearch.yml es的配置文件\n\t\nlib  相关jar包\nmodules 功能模块\nplugins 插件  ik分词器等插件\nlogs  日志<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n</li>\n<li><p>使用 windows下 执行 bin\\elasticsearch.bat</p>\n</li>\n<li><p>访问测试， 默认端口9200，访问 <a href=\"http://localhost:9200/\">http://localhost:9200</a></p>\n</li>\n</ul>\n<h3 id=\"ElasticSearch-Head可视化\"><a href=\"#ElasticSearch-Head可视化\" class=\"headerlink\" title=\"ElasticSearch Head可视化\"></a>ElasticSearch Head可视化</h3><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>elasticsearch-head</p></blockquote>\n<p>下载地址：<a href=\"https://github.com/mobz/elasticsearch-head\">GitHub - mobz&#x2F;elasticsearch-head: A web front end for an elastic search cluster</a></p>\n<p>是一个开源前端web工程，详细的可以直接看github上的文档，这里做下简单介绍</p>\n<p>需要nodejs</p>\n<ul>\n<li>克隆仓库到本地</li>\n</ul>\n<pre class=\"line-numbers language-powershell\" data-language=\"powershell\"><code class=\"language-powershell\">git clone https:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>github<span class=\"token punctuation\">.</span>com/mobz/elasticsearch-head<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<ul>\n<li>安装依赖</li>\n</ul>\n<pre class=\"line-numbers language-powershell\" data-language=\"powershell\"><code class=\"language-powershell\">npm i<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<ul>\n<li>启动</li>\n</ul>\n<pre class=\"line-numbers language-powershell\" data-language=\"powershell\"><code class=\"language-powershell\">npm run <span class=\"token function\">start</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<ul>\n<li><p>访问  <a href=\"http://localhost:9100/\">http://localhost:9100</a></p>\n<p>直接打开会有跨域问题，这时需要配置一下，在<code>elasticsearch.yml</code>中加入以下配置</p>\n</li>\n</ul>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">http.cors.enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token key atrule\">http.cors.allow-origin</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"*\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>重启elasticsearch即可</p>\n<h3 id=\"Kibana\"><a href=\"#Kibana\" class=\"headerlink\" title=\"Kibana\"></a>Kibana</h3><p>针对ES开源分析的可视化平台，用于搜索、查看、管理ES中的数据。</p>\n<p><a href=\"https://www.elastic.co/cn/kibana\">Kibana：数据的探索、可视化和分析 | Elastic</a></p>\n<p>Ps：  Kibana的版本和ES要一致</p>\n<ul>\n<li><p>下载7.6版本的Kibana，windows下解压即可</p>\n</li>\n<li><p>汉化</p>\n<p>配置i18n中的yml，zh-CN</p>\n</li>\n</ul>\n<h2 id=\"ES核心概念\"><a href=\"#ES核心概念\" class=\"headerlink\" title=\"ES核心概念\"></a>ES核心概念</h2><p><strong>物理设计：</strong></p>\n<p>es在后台把每个索引划分成多个分片，每份分片可以在集群中的不同服务器之间迁移。</p>\n<p>一个集群至少有一个节点，而一个节点就是一个es进程，节点可以有多个索引。 在创建索引时，索引会有5个默认分片（也称主分片），每一个主分片又会有一个副本（也称复制分片）</p>\n<p><img src=\"/post/elasticsearch/image-20230818175536165.png\" alt=\"image-20230818175536165\"></p>\n<p>如图是一个有3个节点的集群，可以看到主分片和对应的复制分片不会都在同一个节点上，这样可以保证数据不会丢失。</p>\n<p>一个分片是一个Lucene索引，一个包含倒排索引的文件目录，倒排索引的结构使es在不扫描全部文档的清空下，就能告诉哪些文档包含特定的关键字。</p>\n<p><strong>逻辑设计：</strong></p>\n<p>ES是面向文档 （一个JSON对象），和关系型数据库有如下的对比关系：</p>\n<table>\n<thead>\n<tr>\n<th>关系型数据库</th>\n<th>ElasticSearch</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>数据库(database)</td>\n<td>索引 (indices)</td>\n</tr>\n<tr>\n<td>表(tables)</td>\n<td>类型 (types) (8.x.x版本以上已经弃用)</td>\n</tr>\n<tr>\n<td>行(rows)</td>\n<td>文档 (documents)</td>\n</tr>\n<tr>\n<td>字段(columns)</td>\n<td>属性 (fields)</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p>文档</p>\n<p>es是面向文档的，意味着索引和搜索数据的最小单位是文档，其中，文档有一些重要属性</p>\n<ol>\n<li>自我包含，一篇文档同时包含字段和对应的值，也就是同时包含key : value</li>\n<li>可以是层次型的，文档中包含其他文档</li>\n<li>灵活的结构，不依赖于预先定义的模式</li>\n</ol>\n</li>\n<li><p>类型</p>\n<p>每个field都会有对应的类型，可以提前设置，也可以不设置，es会自动去匹配类型，但也有可能匹配错误。</p>\n</li>\n<li><p>索引</p>\n<p>对应 数据库(database) ，es中的索引是一个很大的文档集合</p>\n</li>\n</ul>\n","feature":true,"text":"ElasticSearch前言版本：7.6 全文检索引擎 SQL查询时， 大数据情况下速度很慢，在加索引都无法满足的情况下，可以选择ES作为解决方案 LuceneLucene是一套信息检索工具jar包，不包含搜索引擎系统 包含： 索引结构 排序功能 搜索规则 Lucene和ES的...","link":"","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"中间件","slug":"中间件","count":1,"path":"api/tags/中间件.json"},{"name":"ElasticSearch","slug":"ElasticSearch","count":1,"path":"api/tags/ElasticSearch.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#ElasticSearch\"><span class=\"toc-text\">ElasticSearch</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Lucene\"><span class=\"toc-text\">Lucene</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#ElasticSearch%E6%A6%82%E8%BF%B0\"><span class=\"toc-text\">ElasticSearch概述</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Solr%E6%A6%82%E8%BF%B0\"><span class=\"toc-text\">Solr概述</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#ES%E5%92%8CSolr%E7%9A%84%E5%B7%AE%E5%88%AB\"><span class=\"toc-text\">ES和Solr的差别</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">安装</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#ElasticSearch-1\"><span class=\"toc-text\">ElasticSearch</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#ElasticSearch-Head%E5%8F%AF%E8%A7%86%E5%8C%96\"><span class=\"toc-text\">ElasticSearch Head可视化</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Kibana\"><span class=\"toc-text\">Kibana</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#ES%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5\"><span class=\"toc-text\">ES核心概念</span></a></li></ol></li></ol>","author":{"name":"Peilin","slug":"blog-author","avatar":"https://www.z4a.net/images/2023/06/23/image-20230622235021158.png","link":"/","description":"Life Oriented Programming","socials":{"github":"https://github.com/wupeilindotme","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{"title":"SpringBoot Test单元测试","uid":"87a20f152595f7bf883ebf6f1ddb89ed","slug":"springboot-test","date":"2023-07-18T09:34:12.000Z","updated":"2023-08-23T13:01:57.056Z","comments":true,"path":"api/articles/springboot-test.json","keywords":null,"cover":null,"text":"不要忽视任何一个小的BUG，这将可能带来灾难 前言单元测试的必要性在工作中有时候会问同事关于单元测试，得到如下回答： 感觉项目挺赶工期的，就算想也没有时间写单元测试 项目业务简单，感觉没有写单元测试的必要 不知道如何写单元测试，还不如就直接调用接口测试 公司有专业测试人员，到时候...","link":"","photos":[],"count_time":{"symbolsCount":"10k","symbolsTime":"9 mins."},"categories":[],"tags":[{"name":"Java","slug":"Java","count":2,"path":"api/tags/Java.json"},{"name":"SpringBoot","slug":"SpringBoot","count":1,"path":"api/tags/SpringBoot.json"},{"name":"单元测试","slug":"单元测试","count":1,"path":"api/tags/单元测试.json"}],"author":{"name":"Peilin","slug":"blog-author","avatar":"https://www.z4a.net/images/2023/06/23/image-20230622235021158.png","link":"/","description":"Life Oriented Programming","socials":{"github":"https://github.com/wupeilindotme","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}